This repo provides steps to solves the problem if Azure VM is not accessible via any credentails 

# Issue with Azure VM unable to access the VM but SSH is working fine.
# issue with duplicate entry in fstab
# OS disk and Data Disk is attached to the broken VM 

## Design of the broken VM
“Keep OS disk tiny and put everything in data disks via LVM”

OS disk (1 GB)
   └─ only /boot, kernel, initramfs

Data disks (3x)
   └─ PV → VG (vg-root) → LV → /

## What's Included?

- Shell scripts to automate (`Access denied.sh`)

## Steps in Azure Portal

1. Create a debugvm (new Azure VM) 

ensure these parameter are equal as per the broken VM: 
VM generation: 1 or 2
Vnet and Subnet

2. Go to disks section of debugvm and attach the data disk (this will create a new data disk with same copy of broken VM - disk name would be different)

3. Follow the script (Access denied.sh) to create a new account or recover it as per ubuntu guideline.

4. after the script is executed, unmount the disk and shutdown the debub vm and deattach the disk and attach it to the broken VM

5. ssh to the VM and login with new account


# Two lessson learned from Azure Portal

1. Reset the password from Azure portal directly 
2. Serial console 
3. Verify UUID in the fstab for /boot and / entry is matching the disk uuid as per the lsblk


# Issue - 2 FSTAB had mulitple entry and failling to mount so commented out duplicate entry
# this also explains how the mapping of storage account happens in the Linux VM

```
asalam@lubtzmng02:~$ cat /etc/fstab
# HEADER: This file was autogenerated at 2021-07-22 16:05:07 +0000
# HEADER: by puppet.  While it can still be managed manually, it
# HEADER: is definitely not recommended.
# /etc/fstab: static file system information.
#
# Use 'blkid' to print the universally unique identifier for a
# device; this may be used with UUID= as a more robust way to name devices
# that works even if disks are added and removed. See fstab(5).
#
# <file system> <mount point>   <type>  <options>       <dump>  <pass>
/dev/mapper/vg0-root    /       ext4    errors=remount-ro       0       1
# /boot was on /dev/sda1 during installation
UUID=xxxx-xxxx-xxxx-xxxx       /boot   ext4    defaults        0       2
/dev/mapper/vg0-tmp     /tmp    ext4    defaults        0       2
/dev/mapper/vg0-var     /var    ext4    defaults        0       2
/dev/mapper/vg0-varlog  /var/log        ext4    defaults        0       2
/dev/mapper/vg0-swap    none    swap    sw      0       0
/dev/sr0        /media/cdrom0   udf,iso9660     user,noauto,nofail      0       0
/dev/mapper/vg0-data    /data   ext4    defaults        0       2
#//storage-name.file.core.windows.net/mongodb-data-delivery /mnt/mongodb-data-delivery cifs nofail,credentials=/etc/smbcredentials/storage-name.cred,dir_mode=0777,file_mode=0777,serverino,nosharesock,actimeo=30
#//storage-name.file.core.windows.net/mongodb-data-delivery /mnt/mongodb-data-delivery cifs nofail,credentials=/etc/smbcredentials/storage-name.cred,dir_mode=0777,file_mode=0777,serverino,nosharesock,actimeo=30
//storage-name.file.core.windows.net/mongodb-data-delivery /mnt/mongodb-data-delivery cifs nofail,credentials=/etc/smbcredentials/storage-name.cred,dir_mode=0777,file_mode=0777,serverino,nosharesock,actimeo=30
#//ip-address/mongodb-data-delivery /mnt/mongodb-data-delivery cifs nofail,credentials=/etc/smbcredentials/stasamongoweu1p600.cred,dir_mode=0777,file_mode=0777,serverino,nosharesock,actimeo=30
//storage-name.file.core.windows.net/data-delivery-db-dumps /mnt/data-delivery-db-dumps cifs nofail,credentials=/etc/smbcredentials/storage-name.cred,dir_mode=0777,file_mode=0777,serverino,nosharesock,actimeo=30
```
